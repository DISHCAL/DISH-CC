<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DISH PAY Rechner</title>
    <!-- Einbindung von jsPDF für die PDF-Funktion -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <script src="script.js" defer></script>
</head>
<body>

<div class="container">
    <h1>DISH PAY Rechner</h1>
    <h3>Kostenberechnung</h3>

    <!-- Dropdown zur Auswahl der Berechnungsart -->
    <label for="calculationType">Berechnungsart: <span>*</span></label>
    <select id="calculationType" onchange="toggleCalculationFields()">
        <option value="schnell">Schnelle Berechnung</option>
        <option value="ausführlich">Ausführliche Berechnung</option>
    </select>

    <!-- Felder für Umsatz und Transaktionen, die immer angezeigt werden -->
    <label for="monthlyVolume">Geplanter Kartenumsatz pro Monat (€): <span>*</span></label>
    <input type="number" id="monthlyVolume" placeholder="z.B. 20000" min="0" required>

    <label for="transactions">Erwartete Anzahl an monatlichen Transaktionen: <span>*</span></label>
    <input type="number" id="transactions" placeholder="z.B. 400" min="0" required>

    <label for="girocard">Girocard (%): <span>*</span></label>
    <input type="number" id="girocard" placeholder="z.B. 70" step="0.01" min="0" max="100" required>

    <label for="mastercardVisa">Mastercard / VISA (%): <span>*</span></label>
    <input type="number" id="mastercardVisa" placeholder="z.B. 30" step="0.01" min="0" max="100" required>

    <!-- Hardware-Auswahl immer anzeigen -->
    <label for="purchaseOption">Kauf oder Miete: <span>*</span></label>
    <select id="purchaseOption" onchange="toggleRentalOptions(); updateRentalPrices();">
        <option value="mieten">Mieten</option>
        <option value="kaufen">Kaufen</option>
    </select>

    <!-- Hardware Dropdown -->
    <div id="hardwareOptions">
        <label for="hardware">Hardware auswählen: <span>*</span></label>
        <select id="hardware" onchange="updateRentalPrices()">
            <option value="S1F2" data-price-once="499.00" data-price-12="44.90" data-price-36="18.90" data-price-60="14.90">S1F2 Terminal</option>
            <option value="V400C" data-price-once="399.00" data-price-12="39.90" data-price-36="16.90" data-price-60="12.90">V400C Terminal</option>
            <option value="MotoG14" data-price-once="119.00" data-price-12="7.90" data-price-36="0" data-price-60="0">Moto G14 Terminal</option>
            <option value="Tap2Pay" data-price-once="0" data-price-12="7.90" data-price-36="0" data-price-60="0">Tap2Pay Lizenz</option>
        </select>
    </div>

    <!-- Mietoptionen für den Mietzeitraum -->
    <div id="rentalOptions">
        <label for="rentalPeriod">Mietdauer: <span>*</span></label>
        <select id="rentalPeriod">
            <option value="12">12 Monate</option>
            <option value="36">36 Monate</option>
            <option value="60">60 Monate</option>
        </select>
    </div>

    <!-- Berechnungsbuttons -->
    <button onclick="calculateCosts()">Berechnen</button>
    <button onclick="downloadPDF()">PDF Angebot herunterladen</button>

    <!-- Ergebnisbereich -->
    <div id="result">
        <h3>Ergebnisse:</h3>
        <div class="result-section">
            <p id="oneTimeCost"></p>
            <p id="monthlyCost"></p>
            <p id="disagioFees"></p>
            <p id="transactionFee"></p>
            <p id="simServiceFee"></p>
            <p id="totalCost"></p>
        </div>
    </div>

    <!-- Informationsfeld zu Gebühren -->
    <div class="info-section">
        <h4>Hinweis zu den Gebühren:</h4>
        <ul>
            <li><b>Transaktionspreis:</b> 0,06 € pro Transaktion</li>
            <li><b>Girocard-Gebühr bis 10.000 € monatlich:</b> 0,39%</li>
            <li><b>Girocard-Gebühr über 10.000 € monatlich:</b> 0,29%</li>
            <li><b>Disagio Maestro / VPAY:</b> 0,89%</li>
            <li><b>Disagio Mastercard/VISA Privatkunden:</b> 0,89%</li>
            <li><b>Disagio Mastercard/VISA Business und NICHT-EWR-RAUM:</b> 2,89%</li>
        </ul>
    </div>

</div>

<script>
    function toggleCalculationFields() {
        const calculationType = document.getElementById('calculationType').value;
        const detailedFields = document.getElementById('detailedFields');
        detailedFields.style.display = calculationType === 'schnell' ? 'none' : 'block';
    }

    function toggleRentalOptions() {
        const purchaseOption = document.getElementById('purchaseOption').value;
        const rentalOptions = document.getElementById('rentalOptions');
        rentalOptions.style.display = purchaseOption === "mieten" ? 'block' : 'none';
    }

    function updateRentalPrices() {
        const hardwareSelect = document.getElementById('hardware');
        const selectedHardware = hardwareSelect.options[hardwareSelect.selectedIndex];

        const rentalPeriodSelect = document.getElementById('rentalPeriod');
        const price12 = selectedHardware.getAttribute('data-price-12');
        const price36 = selectedHardware.getAttribute('data-price-36');
        const price60 = selectedHardware.getAttribute('data-price-60');

        rentalPeriodSelect.options[0].text = `12 Monate - ${price12} €/Monat`;
        rentalPeriodSelect.options[1].text = `36 Monate - ${price36} €/Monat`;
        rentalPeriodSelect.options[2].text = `60 Monate - ${price60} €/Monat`;
    }

    function updateHardwareCosts() {
        const purchaseOption = document.getElementById('purchaseOption').value;
        const hardwareSelect = document.getElementById('hardware');
        const selectedHardware = hardwareSelect.options[hardwareSelect.selectedIndex];
        
        const priceOnce = parseFloat(selectedHardware.getAttribute('data-price-once')) || 0;
        let monthlyCost = 0;

        if (purchaseOption === "mieten") {
            const rentalPeriod = document.getElementById('rentalPeriod').value;
            if (rentalPeriod === "12") {
                monthlyCost = parseFloat(selectedHardware.getAttribute('data-price-12')) || 0;
            } else if (rentalPeriod === "36") {
                monthlyCost = parseFloat(selectedHardware.getAttribute('data-price-36')) || 0;
            } else if (rentalPeriod === "60") {
                monthlyCost = parseFloat(selectedHardware.getAttribute('data-price-60')) || 0;
            }
        } else {
            monthlyCost = 0;  // Keine monatlichen Hardwarekosten bei Kauf
        }

        return { onceCost: priceOnce, monthlyCost };
    }

    function calculateCosts() {
        const purchaseOption = document.getElementById('purchaseOption').value;
        const monthlyVolume = parseFloat(document.getElementById('monthlyVolume').value) || 0;
        const transactions = parseFloat(document.getElementById('transactions').value) || 0;
        
        const girocardFeePercentage = parseFloat(document.getElementById('girocard').value) || 0;
        const mastercardVisaFeePercentage = parseFloat(document.getElementById('mastercardVisa').value) || 0;

        const { onceCost, monthlyCost: hardwareMonthlyCost } = updateHardwareCosts();

        const girocardRevenue = monthlyVolume * (girocardFeePercentage / 100);
        const mastercardVisaRevenue = monthlyVolume * (mastercardVisaFeePercentage / 100);

        const girocardFee = girocardRevenue * (monthlyVolume > 10000 ? 0.0029 : 0.0039);
        const mastercardVisaFee = mastercardVisaRevenue * 0.0089;

        const totalDisagioFees = girocardFee + mastercardVisaFee;
        const transactionFee = transactions * 0.06;

        let simServiceFee = 0;
        const hardwareSelect = document.getElementById('hardware').value;
        if (hardwareSelect === "S1F2" || hardwareSelect === "V400C") {
            simServiceFee = 3.90;
        }

        const totalMonthlyCost = totalDisagioFees + transactionFee + hardwareMonthlyCost + simServiceFee;

        document.getElementById('disagioFees').innerText = `Gebühren gesamt: ${(totalDisagioFees + transactionFee).toFixed(2)} €`;
        document.getElementById('monthlyCost').innerText = `Monatliche Hardwarekosten (Miete): ${hardwareMonthlyCost.toFixed(2)} €`;
        document.getElementById('simServiceFee').innerText = simServiceFee > 0 ? `SIM/Servicegebühr: ${simServiceFee.toFixed(2)} €` : "";
        document.getElementById('totalCost').innerText = `Monatliche Gesamtkosten: ${totalMonthlyCost.toFixed(2)} €`;

        document.getElementById('oneTimeCost').innerText = purchaseOption === "kaufen" ? `Einmalige Kosten (Kauf): ${onceCost.toFixed(2)} €` : "";
    }
</script>

</body>
</html>
